name: Visuelstory

on:
  push:
    branches:
      - workflow
      - staging

jobs:
  prepare-job:
    name: Prepare
    runs-on: ubuntu-latest
    steps:
      - uses: shivammathur/setup-php@v2
        with:
          php-version: "8.2"
          coverage: none
      - name: Checkout Code
        uses: actions/checkout@v5
      - name: Copy .env
        run: php -r "file_exists('.env') || copy('.env.example', '.env');"
      - name: Install Dependencies
        run: composer install -n --prefer-dist
      - name: Generate Key
        run: php artisan key:generate
      - name: Directory Permissions
        run: chmod -R 777 storage bootstrap/cache
      - name: Print Env Variables
        run: printenv
  notify-job:
    name: Notify Telegram
    runs-on: ubuntu-latest
    needs: [prepare-job]
    steps:
      - name: Send Notify Telegram
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_TO }}
          token: ${{ secrets.TELEGRAM_TOKEN }}
          message: |
            ${{ github.actor }} created commit:
            Commit message: ${{ github.event.commits[0].message }}

            Repository: ${{ github.repository }}

            See changes: https://github.com/${{ github.repository }}/commit/${{github.sha}}
